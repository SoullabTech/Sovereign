"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3086],{3086:function(e,t,n){n.d(t,{coherenceDetector:function(){return r}});const r=new class{addReading(e){this.hrvHistory.push(e);const t=Date.now()-60*this.maxHistoryMinutes*1e3;this.hrvHistory=this.hrvHistory.filter((e=>e.startDate.getTime()>t)),this.hrvHistory.sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))}loadHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;const n=Date.now()-60*t*1e3;this.hrvHistory=e.hrv.filter((e=>e.startDate.getTime()>n)).sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))}analyzeCoherence(){if(0===this.hrvHistory.length)return{level:"medium",score:50,trend:"stable",suggestedPresenceState:"dialogue",confidence:0};const e=this.hrvHistory[this.hrvHistory.length-1].value,t=this.hrvHistory.map((e=>e.value)),n=t.reduce(((e,t)=>e+t),0)/t.length,r=t.reduce(((e,t)=>e+Math.pow(t-n,2)),0)/t.length,s=Math.sqrt(r);let i,a,h="stable",o=Math.min(1,this.hrvHistory.length/10);if(this.hrvHistory.length>=5){const e=Math.min(10,Math.floor(this.hrvHistory.length/2)),n=t.slice(-e),r=t.slice(0,-e);if(r.length>0){const e=n.reduce(((e,t)=>e+t),0)/n.length,t=r.reduce(((e,t)=>e+t),0)/r.length;e>1.15*t?(h="rising",o=Math.min(1,1.2*o)):e<.85*t&&(h="falling",o=Math.min(1,1.2*o))}}e<25?(i="low",a=Math.max(0,2*e)):e<45?(i="medium",a=50+1.5*(e-25)):e<65?(i="high",a=80+.75*(e-45)):(i="peak",a=Math.min(100,95+.15*(e-65)));const l=Math.max(0,5-s/n*10);a=Math.min(100,a+l);const c=this.mapCoherenceToPresenceState(i,h,e);return{level:i,score:Math.round(a),trend:h,suggestedPresenceState:c,confidence:o}}mapCoherenceToPresenceState(e,t,n){return"falling"===t||"low"===e?"dialogue":"peak"===e||"high"===e&&"falling"!==t?"scribe":"patient"}getSessionImprovement(e){const t=this.hrvHistory.filter((t=>t.startDate>=e));if(t.length<2)return{improvement:0,startHRV:null,endHRV:null};const n=Math.floor(t.length/2),r=t.slice(0,n),s=t.slice(n),i=r.reduce(((e,t)=>e+t.value),0)/r.length,a=s.reduce(((e,t)=>e+t.value),0)/s.length,h=(a-i)/i*100;return{improvement:Math.round(h),startHRV:Math.round(10*i)/10,endHRV:Math.round(10*a)/10}}shouldSuggestTransition(e,t){return!(t.confidence<.5)&&(e!==t.suggestedPresenceState&&(t.confidence>.8||("low"===t.level&&"falling"===t.trend||"peak"===t.level&&"scribe"!==e)))}getCoherenceDescription(e){const{level:t,trend:n}=e;return"".concat({low:"activated",medium:"balanced",high:"coherent",peak:"deeply coherent"}[t]," and ").concat({rising:"building",stable:"stable",falling:"releasing"}[n])}constructor(){this.hrvHistory=[],this.maxHistoryMinutes=60}}}}]);