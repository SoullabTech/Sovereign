"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8166],{88166:function(t,e,r){r.d(e,{biometricStorage:function(){return o}});const i="healthData";const o=new class{async init(){return this.isInitialized&&this.db?Promise.resolve():(this.initPromise||(this.initPromise=new Promise(((t,e)=>{const r=indexedDB.open("MAIA_Biometrics",1);r.onerror=()=>{console.error("\u274c Failed to open IndexedDB:",r.error),this.initPromise=null,e(r.error)},r.onsuccess=()=>{this.db=r.result,this.isInitialized=!0,this.initPromise=null,console.log("\u2705 Biometric storage initialized"),t()},r.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains(i)){const t=e.createObjectStore(i,{keyPath:"id",autoIncrement:!0});t.createIndex("timestamp","timestamp",{unique:!1}),t.createIndex("type","type",{unique:!1}),console.log("\ud83d\udd27 Created biometric data store")}}}))),this.initPromise)}async storeHealthData(t){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");const e=this.db.transaction([i],"readwrite").objectStore(i),r={timestamp:new Date,type:"apple_health_import",data:t,recordCount:{hrv:t.hrv.length,heartRate:t.heartRate.length,sleep:t.sleep.length,respiratory:t.respiratory.length}};return new Promise(((t,i)=>{const o=e.add(r);o.onsuccess=()=>{console.log("\u2705 Health data stored locally:",r.recordCount),t()},o.onerror=()=>{console.error("\u274c Failed to store health data:",o.error),i(o.error)}}))}async getLatestHealthData(){if(this.db||await this.init(),!this.db)return null;const t=this.db.transaction([i],"readonly").objectStore(i).index("timestamp");return new Promise(((e,r)=>{const i=t.openCursor(null,"prev");i.onsuccess=()=>{const t=i.result;if(t){const r=t.value;"apple_health_import"===r.type?e(r.data):t.continue()}else e(null)},i.onerror=()=>{console.error("\u274c Failed to retrieve health data:",i.error),r(i.error)}}))}async getLatestHRV(){const t=await this.getLatestHealthData();return t&&0!==t.hrv.length?t.hrv[0]:null}async clearAllData(){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");const t=this.db.transaction([i],"readwrite").objectStore(i);return new Promise(((e,r)=>{const i=t.clear();i.onsuccess=()=>{console.log("\ud83d\uddd1\ufe0f All biometric data cleared"),e()},i.onerror=()=>{console.error("\u274c Failed to clear data:",i.error),r(i.error)}}))}async hasHealthData(){const t=await this.getLatestHealthData();return null!==t&&t.hrv.length>0}constructor(){this.db=null,this.isInitialized=!1,this.initPromise=null}}}}]);