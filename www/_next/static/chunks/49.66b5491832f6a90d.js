"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{3049:function(e,o,n){n.d(o,{StreamingAudioQueue:function(){return h},generateAudioChunk:function(){return t},splitIntoSentences:function(){return A}});var i=n(6434);class h{enqueue(e){console.log("\ud83c\udfb5 [StreamingQueue] Enqueuing audio chunk:",e.text.substring(0,50)),this.queue.push(e),this.isPlaying||this.playNext()}async playNext(){var e,o,n,i;if(0===this.queue.length)return console.log("\u2705 [StreamingQueue] Queue empty - playback complete"),this.isPlaying=!1,this.currentAudio=null,null===(n=this.onPlayingChange)||void 0===n||n.call(this,!1),void(null===(i=this.onComplete)||void 0===i||i.call(this));const h=this.queue.shift();return this.isPlaying=!0,this.currentAudio=h.audio,null===(e=this.onPlayingChange)||void 0===e||e.call(this,!0),console.log("\ud83d\udd0a [StreamingQueue] Playing chunk:",h.text.substring(0,50)),null===(o=this.onTextChange)||void 0===o||o.call(this,h.text),this.feedbackPrevention.registerAudioElement(h.audio),new Promise((e=>{h.audio.onended=()=>{console.log("\u2705 [StreamingQueue] Chunk finished"),this.feedbackPrevention.unregisterAudioElement(h.audio),e(),this.playNext()},h.audio.onerror=o=>{console.error("\u274c [StreamingQueue] Audio error:",o),this.feedbackPrevention.unregisterAudioElement(h.audio),e(),this.playNext()},h.audio.play().catch((async o=>{console.error("\u274c [StreamingQueue] Play failed:",o),"NotAllowedError"!==o.name||this.audioUnlocked||(console.log("\ud83d\udd13 [StreamingQueue] Detected NotAllowedError - Safari unlock may be needed"),console.log("\ud83d\udd13 [StreamingQueue] Audio unlock status:",this.audioUnlocked),window.dispatchEvent(new CustomEvent("maya-audio-unlock-needed"))),this.feedbackPrevention.unregisterAudioElement(h.audio),e(),this.playNext()}))}))}stop(){var e;console.log("\ud83d\uded1 [StreamingQueue] Stopping playback and clearing queue"),this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.feedbackPrevention.unregisterAudioElement(this.currentAudio),this.currentAudio=null),this.queue=[],this.isPlaying=!1,null===(e=this.onPlayingChange)||void 0===e||e.call(this,!1)}getStatus(){return{isPlaying:this.isPlaying,queueLength:this.queue.length}}getIsPlaying(){return this.isPlaying}setAudioUnlocked(e){console.log("\ud83d\udd13 [StreamingQueue] Audio unlock status set: ".concat(e)),this.audioUnlocked=e,e&&this.audioContext&&(console.log("\ud83d\udd04 [StreamingQueue] Resuming AudioContext after unlock"),this.audioContext.resume().catch((e=>{console.error("\u274c [StreamingQueue] Failed to resume AudioContext:",e)})))}async unlockSafariAudio(){console.log("\ud83d\udd13 [StreamingQueue] === SAFARI AUDIO UNLOCK DEBUG START ===");const e=navigator.userAgent,o=/Safari/.test(e)&&!/Chrome/.test(e),n=/iPhone|iPad|iPod/.test(e),i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e);console.log("\ud83d\udd13 [StreamingQueue] User agent:",e),console.log("\ud83d\udd13 [StreamingQueue] Safari detection:",{isSafari:o,isiOS:n,isMobile:i});try{this.audioContext?console.log("\ud83d\udd13 [StreamingQueue] Current audioContext state:",this.audioContext.state):console.log("\ud83d\udd13 [StreamingQueue] No existing audioContext"),this.audioContext||(console.log("\u2705 [StreamingQueue] Creating new AudioContext..."),this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("\u2705 [StreamingQueue] AudioContext created successfully")),console.log("\ud83d\udd13 [StreamingQueue] New AudioContext state:",this.audioContext.state),"suspended"===this.audioContext.state&&(console.log("\ud83d\udd04 [StreamingQueue] AudioContext suspended, attempting resume..."),await this.audioContext.resume(),console.log("\u2705 [StreamingQueue] AudioContext resumed to state:",this.audioContext.state));try{console.log("\ud83d\udd27 [StreamingQueue] Attempting Method 1: AudioContext buffer...");const e=this.audioContext.createBuffer(1,1,22050),o=this.audioContext.createBufferSource();o.buffer=e,o.connect(this.audioContext.destination),o.start(0),console.log("\u2705 [StreamingQueue] AudioContext buffer method succeeded")}catch(h){console.warn("\u26a0\ufe0f [StreamingQueue] AudioContext buffer method failed:",h)}try{console.log("\ud83d\udd27 [StreamingQueue] Attempting Method 2: HTML Audio element...");const e=new Audio("data:audio/wav;base64,UklGRnoAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoAAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiS2e/MeCsFJHfH4=");await e.play(),console.log("\u2705 [StreamingQueue] HTML Audio element method succeeded"),e.pause()}catch(A){console.warn("\u26a0\ufe0f [StreamingQueue] HTML Audio element method failed:",A)}this.audioUnlocked=!0,console.log("\ud83d\udd13 [StreamingQueue] === SAFARI AUDIO UNLOCK SUCCESS ==="),window.dispatchEvent(new CustomEvent("maya-audio-unlocked"))}catch(t){throw console.error("\u274c [StreamingQueue] Safari audio unlock failed:",t),console.log("\ud83d\udd13 [StreamingQueue] === SAFARI AUDIO UNLOCK FAILED ==="),t}}getAudioUnlocked(){return this.audioUnlocked}constructor(e){this.queue=[],this.isPlaying=!1,this.currentAudio=null,this.audioContext=null,this.audioUnlocked=!1,this.onPlayingChange=null===e||void 0===e?void 0:e.onPlayingChange,this.onTextChange=null===e||void 0===e?void 0:e.onTextChange,this.onComplete=null===e||void 0===e?void 0:e.onComplete,this.feedbackPrevention=i.d5.getInstance(),window.addEventListener("maya-voice-interrupted",(()=>{console.log("\ud83d\uded1 [StreamingQueue] Received interrupt signal - stopping playback"),this.stop()}))}}function A(e){const o=e.split(/([.!?]+\s+)/).reduce(((e,o,n,i)=>{if(n%2===0&&o.trim()){const h=i[n+1]||"";e.push((o+h).trim())}return e}),[]).filter((e=>e.length>0));return console.log("\ud83d\udcdd [Sentences] Split into ".concat(o.length," chunks:"),o.map((e=>e.substring(0,30)+"..."))),o}async function t(e,o){console.log("\ud83c\udfa4 [TTS] Generating audio for:",e.substring(0,50));try{const n=await fetch("/api/voice/openai-tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,voice:null===o||void 0===o?void 0:o.voice,speed:null===o||void 0===o?void 0:o.speed,voiceTone:null===o||void 0===o?void 0:o.voiceTone,agentVoice:(null===o||void 0===o?void 0:o.agentVoice)||"maya"})});if(!n.ok)throw new Error("TTS failed: ".concat(n.status));const i=await n.blob(),h=URL.createObjectURL(i),A=new Audio(h);return A.onended=()=>{URL.revokeObjectURL(h)},console.log("\u2705 [TTS] Audio chunk generated"),A}catch(n){throw console.error("\u274c [TTS] Failed to generate audio:",n),n}}}}]);