(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9532],{44959:function(e,t,s){Promise.resolve().then(s.bind(s,88092))},88092:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var a=s(57437),r=s(2265),l=s(14820),o=s(5095),i=s(41671),n=s(99388),c=s(51817),d=s(91723),x=s(32660),m=s(82023),h=s(17689),u=s(48736),p=s(42208),g=s(82431),b=s(18930),y=s(99376),f=s(85598),j=s(49322),w=s(32489),N=s(69064);const v={"text/plain":{ext:".txt",icon:u.Z,color:"text-blue-400"},"text/markdown":{ext:".md",icon:u.Z,color:"text-green-400"},"application/pdf":{ext:".pdf",icon:u.Z,color:"text-red-400"},"application/json":{ext:".json",icon:u.Z,color:"text-yellow-400"},"text/csv":{ext:".csv",icon:u.Z,color:"text-amber-400"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:".docx",icon:u.Z,color:"text-indigo-400"}};function k(e){let{onUploadComplete:t,onUploadProgress:s,className:l="",userId:o}=e;const[n,c]=(0,r.useState)([]),x=(0,r.useCallback)((async e=>{for(const t of e)await y(t)}),[]),{getRootProps:m,getInputProps:p,isDragActive:g,fileRejections:b}=(0,f.uI)({onDrop:x,maxSize:10485760,accept:Object.keys(v).reduce(((e,t)=>{const s=v[t];return e[t]=[s.ext],e}),{}),multiple:!0}),y=async e=>{const t="upload-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),s={id:t,file:e,status:"uploading",progress:0};c((e=>[...e,s]));try{const s=new FormData;s.append("file",e),s.append("metadata",JSON.stringify({category:"reference",tags:[],visibility:"private",emotionalWeight:.5}));const a=await fetch("/api/oracle/files/upload",{method:"POST",body:s});if(!a.ok){const e=await a.json();throw new Error(e.error||"Upload failed")}const r=await a.json();c((e=>e.map((e=>e.id===t?{...e,id:r.fileId,status:"processing",progress:10,mayaInsight:r.mayaInsight}:e)))),r.mayaInsight&&N.Am.success(r.mayaInsight,{duration:4e3}),k(r.fileId,t)}catch(a){console.error("Upload error:",a),c((e=>e.map((e=>e.id===t?{...e,status:"error",error:a instanceof Error?a.message:"Upload failed"}:e)))),N.Am.error("Failed to upload file")}},k=async(e,a)=>{let r=0;const l=async()=>{try{const o=await fetch("/api/oracle/files/status?fileId=".concat(e));if(!o.ok)return;const i=await o.json();if(c((t=>t.map((t=>t.id===a||t.id===e?{...t,id:e,status:"completed"===i.file.status?"ready":i.file.status,progress:"completed"===i.file.status?100:"processing"===i.file.status?75:10,mayaInsight:i.file.progressMessage||t.mayaInsight}:t)))),s){const t="completed"===i.file.status?100:"processing"===i.file.status?75:10;s(e,t)}if("completed"===i.file.status){const s=i.file.progressMessage||"Maya has absorbed your wisdom into her consciousness.";t&&t(e,s),N.Am.success(s,{duration:5e3}),setTimeout((()=>{c((t=>t.filter((t=>t.id!==e))))}),3e3)}else"error"===i.file.status?(c((t=>t.map((t=>t.id===e?{...t,status:"error",error:i.file.progressMessage||"Processing failed"}:t)))),N.Am.error("File processing failed")):r<60?(r++,setTimeout(l,2e3)):c((t=>t.map((t=>t.id===e?{...t,status:"error",error:"Processing timeout"}:t))))}catch(o){console.error("Status poll error:",o),r<60&&(r++,setTimeout(l,2e3))}};setTimeout(l,2e3)};return(0,a.jsxs)("div",{className:"space-y-4 ".concat(l),children:[(0,a.jsxs)("div",{...m(),className:"\n          border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200\n          cursor-pointer hover:border-sacred-gold/60\n          ".concat(g?"border-sacred-gold bg-sacred-gold/5":"border-sacred-gold/30 hover:bg-sacred-gold/5","\n        "),children:[(0,a.jsx)("input",{...p()}),(0,a.jsx)(h.Z,{className:"w-8 h-8 mx-auto mb-4 ".concat(g?"text-sacred-gold":"text-sacred-gold/60")}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-300",children:g?"Drop your knowledge here...":"Drop your wisdom here, or click to select files"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"PDF, Text, Markdown, JSON, CSV, DOCX (max 10MB each)"})]})]}),b.length>0&&(0,a.jsx)("div",{className:"space-y-2",children:b.map((e=>{let{file:t,errors:s}=e;var r;return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm text-red-300 truncate",children:t.name}),(0,a.jsx)("p",{className:"text-xs text-red-400",children:null===(r=s[0])||void 0===r?void 0:r.message})]})]},t.name)}))}),n.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-sacred-gold",children:"Processing Files"}),n.map((e=>{const{Icon:t,color:s}=(e=>{const t=v[e];return{Icon:(null===t||void 0===t?void 0:t.icon)||u.Z,color:(null===t||void 0===t?void 0:t.color)||"text-gray-400"}})(e.file.type);return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-black/40 border border-sacred-gold/20 rounded-lg",children:[(0,a.jsx)(t,{className:"w-5 h-5 ".concat(s," flex-shrink-0")}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm text-gray-300 truncate",children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["uploading"===e.status&&(0,a.jsx)(d.Z,{className:"w-4 h-4 text-blue-400 animate-spin"}),"processing"===e.status&&(0,a.jsx)(d.Z,{className:"w-4 h-4 text-yellow-400 animate-pulse"}),"ready"===e.status&&(0,a.jsx)(i.Z,{className:"w-4 h-4 text-green-400"}),"error"===e.status&&(0,a.jsx)(j.Z,{className:"w-4 h-4 text-red-400"}),(0,a.jsx)("button",{onClick:()=>{return t=e.id,void c((e=>e.filter((e=>e.id!==t))));var t},className:"p-1 hover:bg-gray-700/50 rounded",children:(0,a.jsx)(w.Z,{className:"w-3 h-3 text-gray-500"})})]})]}),(0,a.jsx)("div",{className:"mt-2 bg-gray-700 rounded-full h-1.5",children:(0,a.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300 ".concat("error"===e.status?"bg-red-400":"ready"===e.status?"bg-green-400":"bg-sacred-gold"),style:{width:"".concat(e.progress,"%")}})}),e.mayaInsight&&(0,a.jsxs)("p",{className:"text-xs text-sacred-gold/70 mt-1 italic",children:['"',e.mayaInsight,'"']}),e.error&&(0,a.jsx)("p",{className:"text-xs text-red-400 mt-1",children:e.error})]})]},e.id)}))]})]})}function C(){const e=(0,y.useRouter)(),[t,s]=(0,r.useState)([]),[f,j]=(0,r.useState)(null),[w,N]=(0,r.useState)(!0),[v,C]=(0,r.useState)(!1),[Z,S]=(0,r.useState)(null),[P,E]=(0,r.useState)(""),[I,M]=(0,r.useState)("all"),[T,D]=(0,r.useState)(null),U=(0,r.useCallback)((async()=>{try{N(!0);const e=await fetch("/api/oracle/files/status",{method:"POST"}),t=await e.json();t.success&&(s(t.files||[]),j(t.stats||null))}catch(e){console.error("Failed to fetch library:",e)}finally{N(!1)}}),[]);(0,r.useEffect)((()=>{U();const e=setInterval((()=>{t.filter((e=>"processing"===e.status)).length>0&&U()}),3e3);return()=>clearInterval(e)}),[U,t]);const F=t.filter((e=>{var t;const s=e.originalName.toLowerCase().includes(P.toLowerCase())||(null===(t=e.textPreview)||void 0===t?void 0:t.toLowerCase().includes(P.toLowerCase())),a="all"===I||e.category===I;return s&&a})),A=(e,t)=>{switch(e){case"completed":return(0,a.jsx)(i.Z,{className:"w-5 h-5 text-green-400"});case"error":return(0,a.jsx)(n.Z,{className:"w-5 h-5 text-red-400"});case"processing":return(0,a.jsx)(c.Z,{className:"w-5 h-5 text-yellow-400 animate-spin"});default:return(0,a.jsx)(d.Z,{className:"w-5 h-5 text-gray-400"})}},O=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-amber-900 via-blue-900 to-indigo-900",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>e.push("/oracle"),className:"p-2 text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)(x.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(m.Z,{className:"w-8 h-8 text-yellow-400"}),(0,a.jsx)("h1",{className:"text-3xl font-light text-white",children:"Maya's Sacred Library"})]}),(0,a.jsx)("p",{className:"text-amber-200 mt-1",children:"Your uploaded wisdom, woven into Maya's consciousness"})]})]}),(0,a.jsxs)("button",{onClick:()=>C(!0),className:"px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-medium rounded-lg hover:from-yellow-300 hover:to-yellow-500 transition-all duration-200 flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Upload Knowledge"})]})]}),f&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center border border-white/20",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:f.total}),(0,a.jsx)("div",{className:"text-sm text-amber-200",children:"Files"})]}),(0,a.jsxs)("div",{className:"bg-green-500/20 backdrop-blur-sm rounded-lg p-4 text-center border border-green-500/30",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-300",children:f.completed}),(0,a.jsx)("div",{className:"text-sm text-green-200",children:"Absorbed"})]}),(0,a.jsxs)("div",{className:"bg-yellow-500/20 backdrop-blur-sm rounded-lg p-4 text-center border border-yellow-500/30",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-300",children:f.processing}),(0,a.jsx)("div",{className:"text-sm text-yellow-200",children:"Processing"})]}),(0,a.jsxs)("div",{className:"bg-red-500/20 backdrop-blur-sm rounded-lg p-4 text-center border border-red-500/30",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-300",children:f.error}),(0,a.jsx)("div",{className:"text-sm text-red-200",children:"Failed"})]}),(0,a.jsxs)("div",{className:"bg-blue-500/20 backdrop-blur-sm rounded-lg p-4 text-center border border-blue-500/30",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-300",children:f.totalChunks}),(0,a.jsx)("div",{className:"text-sm text-blue-200",children:"Memory Chunks"})]}),(0,a.jsxs)("div",{className:"bg-amber-500/20 backdrop-blur-sm rounded-lg p-4 text-center border border-amber-500/30",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-amber-300",children:[(f.totalTokens/1e3).toFixed(1),"k"]}),(0,a.jsx)("div",{className:"text-sm text-amber-200",children:"Tokens"})]})]}),(0,a.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col md:flex-row gap-4 mb-8",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search your sacred knowledge...",value:P,onChange:e=>E(e.target.value),className:"flex-1 px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-transparent"}),(0,a.jsxs)("select",{value:I,onChange:e=>M(e.target.value),className:"px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400/50 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"All Categories"}),(0,a.jsx)("option",{value:"journal",children:"Journal"}),(0,a.jsx)("option",{value:"reference",children:"Reference"}),(0,a.jsx)("option",{value:"wisdom",children:"Wisdom"}),(0,a.jsx)("option",{value:"personal",children:"Personal"})]})]}),(0,a.jsx)(o.M,{mode:"wait",children:w?(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center py-20",children:(0,a.jsx)(c.Z,{className:"w-12 h-12 text-yellow-400 animate-spin"})},"loading"):0===F.length?(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center py-20",children:[(0,a.jsx)(u.Z,{className:"w-16 h-16 mx-auto mb-4 text-gray-500"}),(0,a.jsx)("h3",{className:"text-xl text-white mb-2",children:"No sacred knowledge yet"}),(0,a.jsx)("p",{className:"text-amber-200 mb-6",children:"Upload your first document to begin building Maya's wisdom"}),(0,a.jsx)("button",{onClick:()=>C(!0),className:"px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-medium rounded-lg hover:from-yellow-300 hover:to-yellow-500 transition-all duration-200",children:"Upload First File"})]},"empty"):(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-4",children:F.map(((e,t)=>{return(0,a.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg p-6 hover:bg-white/15 transition-all duration-200",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-gray-400"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-white truncate flex-1",children:e.originalName}),e.category&&(0,a.jsx)("span",{className:"px-3 py-1 text-xs rounded-full border ".concat((s=e.category,{journal:"bg-blue-500/20 text-blue-300 border-blue-500/30",reference:"bg-green-500/20 text-green-300 border-green-500/30",wisdom:"bg-amber-500/20 text-amber-300 border-amber-500/30",personal:"bg-pink-500/20 text-pink-300 border-pink-500/30"}[s]||"bg-gray-500/20 text-gray-300 border-gray-500/30")),children:e.category}),A(e.status,e.progress)]}),(0,a.jsx)("div",{className:"text-sm text-amber-200 mb-2",children:"completed"===e.status?(0,a.jsxs)("span",{children:[e.totalChunks," memory chunks \u2022 ",e.totalTokens," tokens"]}):(0,a.jsx)("span",{children:e.progressMessage})}),"processing"===e.status&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-yellow-400 to-yellow-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})}),(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:[e.progress,"% complete"]})]}),e.textPreview&&(0,a.jsx)("p",{className:"text-sm text-gray-300 line-clamp-2 mb-3",children:e.textPreview}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,a.jsxs)("span",{children:["Uploaded ",O(e.createdAt)]}),e.processedAt&&(0,a.jsxs)("span",{children:["\u2022 Absorbed ",O(e.processedAt)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>S(e),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"View details",children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})}),"error"===e.status&&(0,a.jsx)("button",{onClick:()=>(async e=>{try{(await fetch("/api/oracle/files/manage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reprocess",fileId:e})})).ok&&await U()}catch(t){console.error("Reprocess failed:",t)}})(e.id),className:"p-2 text-gray-400 hover:text-yellow-400 transition-colors",title:"Retry processing",children:(0,a.jsx)(g.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>(async e=>{if(T===e)try{(await fetch("/api/oracle/files/manage?fileId=".concat(e),{method:"DELETE"})).ok&&(await U(),D(null))}catch(t){console.error("Delete failed:",t)}else D(e)})(e.id),className:"p-2 transition-colors ".concat(T===e.id?"text-red-400 hover:text-red-300":"text-gray-400 hover:text-red-400"),title:T===e.id?"Click again to confirm":"Delete file",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})]})},e.id);var s}))},"files")}),(0,a.jsx)(o.M,{children:v&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>C(!1),children:(0,a.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-gradient-to-br from-amber-900 to-blue-900 p-8 rounded-2xl max-w-2xl w-full border border-white/20",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)(m.Z,{className:"w-12 h-12 mx-auto mb-4 text-yellow-400"}),(0,a.jsx)("h2",{className:"text-2xl font-light text-white mb-2",children:"Share Your Wisdom"}),(0,a.jsx)("p",{className:"text-amber-200",children:"Upload documents for Maya to weave into her consciousness"})]}),(0,a.jsx)(k,{onUploadComplete:(e,t)=>{U(),setTimeout((()=>{C(!1)}),3e3)},onUploadProgress:(e,t)=>{},className:"border-2 border-dashed border-white/30 rounded-lg hover:border-yellow-400/50 transition-colors"}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"mt-6 w-full py-2 text-amber-200 hover:text-white transition-colors",children:"Close"})]})})}),(0,a.jsx)(o.M,{children:Z&&(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>S(null),children:(0,a.jsxs)(l.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-gradient-to-br from-amber-900 to-blue-900 p-8 rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-white/20",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-light text-white mb-2",children:Z.originalName}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-amber-200",children:[(0,a.jsxs)("span",{children:["Status: ",Z.status]}),Z.totalChunks>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"\u2022"}),(0,a.jsxs)("span",{children:[Z.totalChunks," chunks"]}),(0,a.jsx)("span",{children:"\u2022"}),(0,a.jsxs)("span",{children:[Z.totalTokens," tokens"]})]})]})]}),Z.textPreview&&(0,a.jsxs)("div",{className:"bg-white/10 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white mb-3",children:"Preview"}),(0,a.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed whitespace-pre-wrap",children:Z.textPreview})]}),(0,a.jsx)("button",{onClick:()=>S(null),className:"w-full py-2 text-amber-200 hover:text-white transition-colors",children:"Close"})]})})})]})})}}},function(e){e.O(0,[7040,873,5449,2971,2117,1744],(function(){return t=44959,e(e.s=t);var t}));var t=e.O();_N_E=t}]);